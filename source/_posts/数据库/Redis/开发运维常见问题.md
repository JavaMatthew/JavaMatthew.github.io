---
title: 开发运维常见问题
date: 2020-11-19 16:07:08
tags: redis
categories: redis
---
## fork操作

1. 同步操作
2. 内存量息息相关：内存越大，耗时越长（与机器类型有关）
3. info：latest_fork_usec

### 改善fork

1. 优先使用物理机或者高效支持fork操作的虚拟化技术
2. 控制Redis实例最大可用内存：maxmemory
3. 合理配置Linux内存分配策略：vm.overcommit_memory = 1
4. 降低fork频率：例如放宽AOF重写自动触发时机，不必要的全量复制

## 子进程开销和优化

1. CPU：

- 开销：RDB和AOF文件生成，属于CPU密集型
- 优化：不做CPU绑定，不和CPU密集型部署

2. 内存：

- 开销：fork内存开销，copy-on-wirte
- 优化：echo never > /sys/kernel/mm/transparent_hugepage/enabled

3. 硬盘

- 开销：AOF和RDB文件写入，可用结合iostat，iotop分析

### 硬盘优化

1. 不要和高硬盘负载服务部署一起：存储服务、消息队列等
2. no-appendfsync-on-rewrite = yes
3. 根据写入量 决定磁盘类型：例如ssd
4. 单机多实例持久化文件目录可用考虑分盘

## AOF追加阻塞

{% asset_img AOF追加阻塞.png AOF追加阻塞%}
