---
title: 忘记密码
p: 数据库/MySQL/忘记密码
date: 2020-01-06 09:52:09
tags: MySQL
categories: MySQL
---
## 如何强制更改Docker容器中的Mysql密码（忘记密码）

### 问题描述

使用docker容器时，通过镜像安装了Mysql5.7版本，但忘记了root密码，需要重新设置root密码

### 解决步骤

1. 增加“忘记密码启动”模式

2. 重新设置root密码

3. 删掉“忘记密码启动”模式

4. 重启容器镜像即可

### 具体操作

1. 通过docker exec命令进入容器内
    `docker exec -it mysql5.7.28 /bin/sh`
    注：mysql5.7.8是我安装mysql数据库的容器名

2. 编辑mysql配置文件，增加“忘记密码启动”模式：skip-grant-tables
    `vi /etc/mysql/conf.d/docker.cnf`
    注：编辑的配置文件不是/etc/mysql/my.cnf，也不是/etc/mysql/mysql.cnf或/etc/mysql/conf.d/mysql.cnf
    最终配置文件docker.cnf内容如下：

    ```shell
    [mysqld]
    skip-host-cache
    skip-name-resolve
    skip-grant-tables
    ```

3. 退出容器，重启容器实例

    ```shell
    vi /etc/mysql/conf.d/docker.cnf
    exit
    docker restart mysql5.7.8
    ```

4. 通过步骤1再次进入容器，输入myql命令，免密码直接登录mysql

    ```shell
    docker exec -it mysql5.7.8 /bin/sh
    mysql
    ```

5. 设置root用户新密码：root。刷新权限，退出mysql

    ```mysql
    #切换实例，user表位于mysql实例下
    mysql> use mysql;
    #更改root密码
    5.7以后版本更新密码用这个
    update user set authentication_string=password("新密码") where user="root";
    5。7以前更新密码用这个
    mysql> UPDATE user SET Password = password ( 'a123456' ) WHERE User = 'root';
    # 刷新权限
    mysql> flush privileges;
    # 退出
    mysql> quit
    ```

6. 重新编辑mysql配置文件docker.cnf，删掉“忘记密码启动”模式
    `vi /etc/mysql/conf.d/docker.cnf`

7. 退出容器，重启容器即可
    `docker restart mysql5.7.8`
