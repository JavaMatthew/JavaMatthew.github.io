---
title: 基本操作
p: 数据库/Neo4j/基本操作
date: 2021-02-21 23:00:37
tags: Neo4j
categories: Neo4j
---

## 基本操作

> neo4j 查询时带箭头代表单向关系，不带箭头代表双向关系

```java
package com.mega.werewolf.cloud.jp.contact.neo4j;

import lombok.Data;
import lombok.experimental.Accessors;
import org.springframework.data.neo4j.core.schema.Id;
import org.springframework.data.neo4j.core.schema.Node;
import org.springframework.data.neo4j.core.schema.Relationship;

import java.time.LocalDateTime;
import java.util.List;

@Data
@Node
@Accessors(chain = true)
public class Person {
    @Id
    private Integer userId;

    // 用户名称
    private String nickName;

    // 用户登录时间
    private LocalDateTime loginTime;

    @Relationship(type = "Friend", direction = Relationship.Direction.OUTGOING)
    private List<Friend> friendList;

}

```

```java
package com.mega.werewolf.cloud.jp.contact.neo4j;

import lombok.Data;
import lombok.experimental.Accessors;
import org.springframework.data.neo4j.core.schema.RelationshipProperties;
import org.springframework.data.neo4j.core.schema.TargetNode;
import org.springframework.data.redis.core.index.Indexed;

import java.time.LocalDateTime;

@Data
@RelationshipProperties
@Accessors(chain = true)
public class Friend {

    // 好友关系：0: 普通关系，1: 兄弟，2:闺蜜，999: CP
    private Integer type = 0;
    // 备注
    private String remark = "";
    // 亲密值
    private Integer intimacy = 0;
    // 亲密等级
    private Integer intimacyLevel = 0;
    // 关系申请状态，4：未处理，1：同意，2：拒绝，3：超时
    private Integer letterState = 0;
    // 申请关系：1: 兄弟，2:闺蜜，999: CP
    private Integer letterType = 0;
    // 关系申请ID tfriendmessage表id
    private Integer letterId = 0;
    // 创建时间
    private LocalDateTime createTime = LocalDateTime.now();
    // 亲密关系创建时间
    private Long intimacyCreateTime;
    // 亲密度修改时间
    private Long intimacyUpdateTime;
    @TargetNode
    private Person person;
}
```

## 查询

```java
   /** 
    * 查找好友的所有信息
    */
@Query("MATCH (u:Person)-[a:Friend]-(f:Person) " +
        "WHERE u.userId = $userId AND f.userId = $friendId " +
        "RETURN u,collect(a),collect(f)")
Person findByUserIdAndFriendId(Integer userId, Integer friendId);
```

## 更新

```java
@Query("MATCH (u:Person)-[a:Friend]->(f:Person) " +
        "WHERE u.userId = $userId AND f.userId = $friendId " +
        "SET a.remark = $name")
void updateRemark(Integer userId, Integer friendId, String name);
```

## 删除

```java
/**
* 删除双向好友关系
*
* @param userId   用户Id
* @param friendId 好友Id
*/
@Query("MATCH (u:Person)-[a:Friend]-(f:Person) " +
    "WHERE u.userId = $userId AND f.userId = $friendId " +
    "DELETE a")
void deleteFriend(Integer userId, Integer friendId);
```
