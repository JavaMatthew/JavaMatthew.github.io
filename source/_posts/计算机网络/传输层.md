---
title: 传输层
p: 计算机网络/传输层
date: 2020-02-22 17:16:52
tags: 计算机网络
categories: 计算机网络
---
## 传输层

传输层的功能
传输层协议UDP和TCP
网络安全
TCP可靠传输的实现
TCP的流量控制
TCP的拥塞控制
TCP的运输连接管理

## OSI和DoD模型

{% asset_img OSI和DoD模型.png OSI和DoD模型 %}
**需要记住！！！！**

数据包65535 -> 分段46-1500
TCP 需要将传输的文件分段 传输建立会话 可靠传输 流量控制
    文件传输 邮件传输 ftp下载文件
UDP 一个数据包就能够完成数据通信 不分段 不需要建立会话 不需要流量控制 不可靠传输
    qq聊天 屏幕广播 多播 广播

查看会话 netstat -n
查看简历会话的进程 netstat -nb

## 传输层协议和应用层协议之间的关系

{% asset_img 应用层协议.png 应用层协议 %}

常见的应用层协议使用的端口
http = TCP + 80
https = TCP + 443
RDP = TCP + 3389
ftp = TCP + 21
共享文件夹 = TCP + 445
SMTP = TCP + 25
POP3 = TCP + 110
telnet = TCP + 23
SQL = TCP + 1433
DNS = UDP + 53

## 传输层--服务和端口

1. 服务和应用层协议之间关系
    服务使用 TCP或UDP的端口侦听客户端请求
    客户端使用IP地址定位服务器 使用目标端口 定位服务
    可以在都武器网卡上设置只开放必要的端口 实现服务器网络安全

2. 如何在Windows上安装服务
    DNS服务
    Web服务
    SMTP服务
    POP3服务

3. 如何查看服务侦听的端口
    mstsc 远程连接
    netstat -an
    netstat -n 查看建立的会话
    netstat -nb 查看简历会话的进程
    telnet 192.168.80.100 3389 测试到远程计算机某个端口是否打开

4. 如何更改服务使用默认端口
    迷惑入侵者使系统更加安全

5. 如何设置Windows网络安全
    设置本地连接 TCP/IP筛选

## 传输层功能和端口范围

传输层的功能 为象互通信的应用进程提供了逻辑通信

传输层的端口
TCP的协议号6
UDP的协议号17
IGMP的协议号1

### TCP的端口

端口用一个16位端口号进行标志。
端口号只具有**本地**意义，即端口号只是为了标志本 计算机应用层中的各进程。在因特网中不同计算机的相同端口号使没有联系的。

端口范围0-65535，熟知端口 0-1023，登记端口 RDP 3389 ，客户端端口 49152-65535
netstat -n : find "ESTABLISHED"

## UDP

### UDP的首部

{% asset_img UDP.png UDP %}
{% asset_img UDP首部格式.png UDP首部格式 %}

## TCP

- TCP使面向连接的传输层协议。
- 每一条TCP连接只能由两个端点（endpoint），每一条TCP连接只能使点对点的（一对一）
- TCP提供可靠交付的服务
- TCP提供全双工通信
- 面向字节流

### TCP的连接

TCP把连接作为最基本的对象，每一条TCP连接有两个端点，TCP连接的端点不是主机，不是主机的IP地址，不是应用进程，也不是传输层的协议端口。
TCP连接的端点叫做**套接字**（socket）

端口号+IP地址=套接字

### TCP如何实现可靠传输

{% asset_img 可靠传输.png 可靠传输 %}
{% asset_img 确认丢失和确认迟到.png 确认丢失和确认迟到 %}

使用上述的确认和重传机制，我们就可以**在不可靠的传输网络上实现可靠的通信。**
这种可靠传输协议常称为**自动重传请求ARQ**（Automatic Repeat reQuest)
ARQ表明重传的请求使**自动**进行的。接收方不需要请求发送方重传某个出错的分组。

使用滑动窗口技术来进行可靠的流水线传输，同时可以通过累积确认来提高效率。
{% asset_img TCP报文段的首部格式.png TCP报文段的首部格式 %}
{% asset_img TCP通信.png TCP通信 %}

### TCP的流量控制

通过TCP的缓存和TCP的确认机制，每过一段时间就从接收方返回可接受的流量大小，来进行流量控制

### TCP避免拥塞

{% asset_img 拥塞控制.png 拥塞控制 %}
慢开始并拥塞控制，如果没有拥塞就把拥塞窗口扩大，如果拥塞就减小。

### TCP的传输连接管理

传输连接由三个阶段，即：**连接建立、数据传送和连接释放。**

TCP连接的建立都是采用**客户服务器方式**。
主动发起连接建立的应用进程叫做**客户**（client）。
被动等待连接建立的应用进程叫做**服务器**（server）。

{% asset_img TCP连接建立.png TCP连接建立 %}

SYN=1，代表同步数据包

{% asset_img TCP连接释放.png TCP连接释放 %}
{% asset_img 连接释放.png 连接释放 %}
{% asset_img 连接释放2.png 连接释放2 %}
{% asset_img 连接释放3.png 连接释放3 %}
{% asset_img 断开连接状态.png 断开连接状态 %}
