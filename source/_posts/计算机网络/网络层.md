---
title: 网络层
p: 计算机网络/网络层
date: 2020-02-03 14:40:15
tags: 计算机网络
categories: 计算机网络
---
网络层提供的服务
网络层协议
网络层如何转发数据包
网络设备
IP协议
    RIP
    OSPF
ARP协议
网际控制报文 ICMP
Internet组播管理协议 IGMP
IP数据包格式
<!-- more -->
## 网络层

负责在不同网络之间转发数据包
基于数据包的IP地址转发
不负责丢失重传，不负责顺序
{% asset_img 数据包在互联网中的传送.png 数据包在互联网中的传送 %}

## 网络设备和OSI模型

计算机通信的过程 本网段通信跨网段通信的过程

发送端

1. 应用此程序准备要传输的文件
2. 传输层 将文件分段 并编号
3. 网络层 添加目标IP地址源IP地址
4. 数据链路层 两种情况 使用自己的子网掩码 判断自己在哪个网段
                      使用自己的子网掩码 判断目标地址在哪个网段
                      如果是同一个网段 arp协议广播解析目标IP地址的MAC地址
                      如果不是一个网段
{% asset_img 发送数据的过程.png 发送数据的过程 %}

## 网络层协议

### TCP/IP协议之间层次

{% asset_img TCPIP协议.png TCPIP协议 %}

ARP 将IP地址通过广播 目标MAC地址是FF-FF-FF-FF-FF-FF解析目标IP地址的MAC地址

ARP欺骗是数据链路层故障，通过发送错误的MAC地址来控制其他计算机的通信。
网络执法官
arp -s 192.168.80.1 00-0C-29-53-48-C3
arp -a
本地连接 恢复

### 网际控制报文协议 ICMP

#### ping命令诊断网络故障

1. PING（Packet Internet Grope），因特网包探索器，用于测试网络连接量的程序。Ping发送一个ICMP回声请求消息给目的地并报告是否收到所希望的ICMP回声应答。
2. ping指的是端对端连通，通常用来作为可用性的检查，但是某些病毒木马会强行大量远程执行ping命令抢占你的网络资源，导致系统变慢，网速变慢。严禁ping入侵作为大多数防火墙的一个基本功能提供给用户进行选择。
3. 如果你打开IE浏览器访问网站失败，你可以通过ping命令测试到Internet的网络连通，可以为你排除网络故障提供线索，下面展示ping命令返回的信息以及分析其原因。

#### 使用ICMP协议的命令

ping time 查看延迟
    Linux 64
    Windows 128
    Unix 255

当TTL耗尽时这个数据包将会被丢失，防止一个包在路由器中循环传递
ping 10.9.0.1 -t
ping -l 200 10.9.0.1
ping 10.9.0.1 -l 200
ping 8.8.8.8 -i 2 更改数据包TTL事件 能够跟踪数据包途径的路由器
pathping 根据数据包路径 计算丢包情况
Windows上跟踪数据包路径的命令
tracert 10.9.0.1
在路由器上跟踪数据包路径的命令
traceroute 10.9.0.1

### IGMP

点到点
广播
组播 = 多播

### IP数据包结构

IP数据包由首部+数据组成

{% asset_img 首部.png 首部 %}
版本 用来表示TCP/IP协议的版本 v4 v6
区分服务 Windows 2008上 gpedit.msc
标识 通过标识确定哪些不同的片是一个包
标志 是否是完整的数据包

网络层 数据包 65535字节
数据链路层 如果不分片 数据包数据最大不超过1500字节 最大传输单元MTU

#### 首部协议号

指明数据包哪个部分交给哪个协议处理
{% asset_img IP数据包首部.png IP数据包首部 %}

协议号  1
IGMP协议    2
TCP 6
UDP 17
IPv6    41
OSPF    89

#### 首部校验和

{% asset_img 校验过程.png 校验过程 %}

## 网络层的一些应用

1. 使用抓包工具排除网络故障
2. 网络畅通的条件 数据包有去有回（计算机必须配网关，计算机到服务器沿途的路由器必须畅通）
3. 静态路由，
    静态路由需要管理员高速路由器所有没有直连的网络下一跳给谁
    静态路由的缺点 适合于小规模网络 不能够自动调整路由

   动态路由，
    RIP 周期性广播路由表 条数 30秒更新一下路由信息 最大跳数：15跳
