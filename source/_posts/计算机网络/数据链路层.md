---
title: 数据链路层
p: 计算机网络/数据链路层
date: 2019-12-25 19:52:02
tags: 计算机网络
categories: 计算机网络
---
## 数据链路层的信道类型

点对点信道。这种信道使用一对一的点对点通信方式。
广播信道。这种信道使用一对多的广播通信方式，因此过程比较复杂。广播信道上连接的主机很多，因此必须使用专用的共享信道协议来协调这些主机的数据发送。

## 使用点对点信道的数据链路层

### 数据链路和帧

1. `链路(link)`是一条无源的点到点的物理线路段，中间没有任何其他的交换结点。**一条链路只是一条通路的一个组成部分.**

2. `数据链路(data link)`除了物理线路外，还必须有通信协议来控制这些数据的传输。若把实现这些协议的硬件和软件加到链路上，就构成了数据链路。
    **现在最常用的方法是使用适配器（即网卡）来实现这些协议的硬件和软件。**
    **一般的适配器都包括了数据链路层和物理层这两层的功能。**
3. {% asset_img 帧.png 帧%}
    常常在两个对等的数据链路层之间画出一个数字管道，而在这条数字管道上传输的数据单位是帧。
    早期的数据通信协议曾叫作通信规程(procedure)。因此在数据链路层，规程和协议是同义语。
    帧 帧头 帧尾 物理层地址 校验值

## 封装成帧

- 封装成帧(framing)就是在一段数据的前后分别添加首部和尾部，然后就构成了一个帧。确定帧的界限。
- 首部和尾部的一个重要作用就是进行**帧定界**。
{% asset_img 封装成帧.png 封装成帧%}

## 透明传输

{% asset_img 透明传输.png 透明传输%}

### 字节填充透明传输

发送端的数据链路层在数据中出现控制字符“SOH”或“EOT”的前面插入一个转义字符“ESC”(其十六进制编码是 1B)。
`字节填充(byte stuffing)`或`字符填充(character stuffing)`——接收端的数据链路层在将数据送往网络层之前删除插入的`转义字符`。
如果转义字符也出现数据当中，那么应在转义字符前面插入一个转义字符。当接收端收到连续的两个转义字符时，就删除其中前面的一个。
{% asset_img 字节填充透明传输.png 字节填充透明传输%}

## 差错检测

- 在传输过程中可能会产生`比特差错`：1 可能会变成 0 而 0 也可能变成 1。
- 在一段时间内，传输错误的比特占所传输比特总数的比率称为`误码率` BER (Bit Error Rate)。
- 误码率与信噪比有很大的关系。
- 为了保证数据传输的可靠性，在计算机网络传输数据时，必须采用各种差错检测措施。

### 循环冗余检验的原理

在数据链路层传送的帧中，广泛使用了循环冗余检验 CRC 的检错技术。
在发送端，先把数据划分为组。假定每组 k 个比特。
假设待传送的一组数据 M = 101001（现在 k = 6）。我们在 M 的后面再添加供差错检测用的 n 位冗余码一起发送。

### 冗余码的计算

用二进制的模 2 运算进行 2n 乘 M 的运算，这相当于在 M 后面添加 n 个 0。
得到的 (k + n) 位的数除以事先选定好的长度为 (n + 1) 位的除数 P，得出商是 Q 而余数是 R，余数 R 比除数 P 少1 位，即 R 是 n 位。

### 冗余码的计算举例

现在 k = 6, M = 101001。
设 n = 3, 除数 P = 1101，
被除数是 2nM = 101001000。
模 2 运算的结果是：商 Q = 110101，
           余数 R = 001。
把余数 R 作为冗余码添加在数据 M 的后面发送出去。发送的数据是：2nM + R
   即：101001001，共 (k + n) 位。

{% asset_img 循环冗余检验CRC.png 循环冗余检验CRC%}

### 帧检验序列 FCS

- 在数据后面添加上的冗余码称为帧检验序列 FCS (Frame Check Sequence)。
- 循环冗余检验 CRC 和帧检验序列 FCS并不等同。
  - CRC 是一种常用的检错方法，而 FCS 是添加在数据后面的冗余码。
  - FCS 可以用 CRC 这种方法得出，但 CRC 并非用来获得 FCS 的唯一方法。  

### 接收端对收到的每一帧进行 CRC 检验

(1) 若得出的余数 R = 0，则判定这个帧没有差错，就接受(accept)。
(2) 若余数 R  0，则判定这个帧有差错，就丢弃。
但这种检测方法并不能确定究竟是哪一个或哪几个比特出现了差错。
只要经过严格的挑选，并使用位数足够多的除数 P，那么出现检测不到的差错的概率就很小很小。

### 应当注意

仅用循环冗余检验 CRC 差错检测技术只能做到无差错接受(accept)。
“无差错接受”是指：“凡是接受的帧（即不包括丢弃的帧），我们都能以非常接近于 1 的概率认为这些帧在传输过程中没有产生差错”。
也就是说：“凡是接收端数据链路层接受的帧都没有传输差错”（有差错的帧就丢弃而不接受）。
要做到“可靠传输”（即发送什么就收到什么）就必须再加上确认和重传机制。
