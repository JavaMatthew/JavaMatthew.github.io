---
title: 数据链路层
p: 计算机网络/数据链路层
date: 2019-12-25 19:52:02
tags: 计算机网络
categories: 计算机网络
---
## 数据链路层的信道类型

点对点信道。这种信道使用一对一的点对点通信方式。
广播信道。这种信道使用一对多的广播通信方式，因此过程比较复杂。广播信道上连接的主机很多，因此必须使用专用的共享信道协议来协调这些主机的数据发送。

## 使用点对点信道的数据链路层

### 数据链路和帧

1. `链路(link)`是一条无源的点到点的物理线路段，中间没有任何其他的交换结点。**一条链路只是一条通路的一个组成部分.**

2. `数据链路(data link)`除了物理线路外，还必须有通信协议来控制这些数据的传输。若把实现这些协议的硬件和软件加到链路上，就构成了数据链路。
    **现在最常用的方法是使用适配器（即网卡）来实现这些协议的硬件和软件。**
    **一般的适配器都包括了数据链路层和物理层这两层的功能。**
3. {% asset_img 帧.png 帧%}
    常常在两个对等的数据链路层之间画出一个数字管道，而在这条数字管道上传输的数据单位是帧。
    早期的数据通信协议曾叫作通信规程(procedure)。因此在数据链路层，规程和协议是同义语。
    帧 帧头 帧尾 物理层地址 校验值

## 封装成帧

- 封装成帧(framing)就是在一段数据的前后分别添加首部和尾部，然后就构成了一个帧。确定帧的界限。
- 首部和尾部的一个重要作用就是进行**帧定界**。
{% asset_img 封装成帧.png 封装成帧%}

## 透明传输

{% asset_img 透明传输.png 透明传输%}

### 字节填充透明传输

发送端的数据链路层在数据中出现控制字符“SOH”或“EOT”的前面插入一个转义字符“ESC”(其十六进制编码是 1B)。
`字节填充(byte stuffing)`或`字符填充(character stuffing)`——接收端的数据链路层在将数据送往网络层之前删除插入的`转义字符`。
如果转义字符也出现数据当中，那么应在转义字符前面插入一个转义字符。当接收端收到连续的两个转义字符时，就删除其中前面的一个。
{% asset_img 字节填充透明传输.png 字节填充透明传输%}

## 差错检测

- 在传输过程中可能会产生`比特差错`：1 可能会变成 0 而 0 也可能变成 1。
- 在一段时间内，传输错误的比特占所传输比特总数的比率称为`误码率` BER (Bit Error Rate)。
- 误码率与信噪比有很大的关系。
- 为了保证数据传输的可靠性，在计算机网络传输数据时，必须采用各种差错检测措施。

### 循环冗余检验的原理

在数据链路层传送的帧中，广泛使用了循环冗余检验 CRC 的检错技术。
在发送端，先把数据划分为组。假定每组 k 个比特。
假设待传送的一组数据 M = 101001（现在 k = 6）。我们在 M 的后面再添加供差错检测用的 n 位冗余码一起发送。

### 冗余码的计算

用二进制的模 2 运算进行 2n 乘 M 的运算，这相当于在 M 后面添加 n 个 0。
得到的 (k + n) 位的数除以事先选定好的长度为 (n + 1) 位的除数 P，得出商是 Q 而余数是 R，余数 R 比除数 P 少1 位，即 R 是 n 位。

### 冗余码的计算举例

现在 k = 6, M = 101001。
设 n = 3, 除数 P = 1101，
被除数是 2nM = 101001000。
模 2 运算的结果是：商 Q = 110101，
           余数 R = 001。
把余数 R 作为冗余码添加在数据 M 的后面发送出去。发送的数据是：2nM + R
   即：101001001，共 (k + n) 位。

{% asset_img 循环冗余检验CRC.png 循环冗余检验CRC %}

### 帧检验序列 FCS

- 在数据后面添加上的冗余码称为帧检验序列 FCS (Frame Check Sequence)。
- 循环冗余检验 CRC 和帧检验序列 FCS并不等同。
  - CRC 是一种常用的检错方法，而 FCS 是添加在数据后面的冗余码。
  - FCS 可以用 CRC 这种方法得出，但 CRC 并非用来获得 FCS 的唯一方法。  

### 接收端对收到的每一帧进行 CRC 检验

(1) 若得出的余数 R = 0，则判定这个帧没有差错，就接受(accept)。
(2) 若余数 R  0，则判定这个帧有差错，就丢弃。
但这种检测方法并不能确定究竟是哪一个或哪几个比特出现了差错。
只要经过严格的挑选，并使用位数足够多的除数 P，那么出现检测不到的差错的概率就很小很小。

### 应当注意

仅用循环冗余检验 CRC 差错检测技术只能做到无差错接受(accept)。
“无差错接受”是指：“凡是接受的帧（即不包括丢弃的帧），我们都能以非常接近于 1 的概率认为这些帧在传输过程中没有产生差错”。
也就是说：“凡是接收端数据链路层接受的帧都没有传输差错”（有差错的帧就丢弃而不接受）。
要做到“可靠传输”（即发送什么就收到什么）就必须再加上确认和重传机制。

## 点到点通信数据链路层协议PPP

### PPP协议使用场合

{% asset_img ppp协议使用场合.png ppp协议使用场合 %}

### PPP协议

现在在全世界使用得最多得数据链路层协议是点对点协议PPP（Point-to-Point Protocol）
用户使用拨号电话线接入因特网时，一般都是使用PPP协议

### PPP协议的组成

- PPP协议有三个组成部分
  - 数据链路层协议可以用于异步串行或同步串行介质
  - 它使用LCP（链路控制协议）建立并维护数据链路连接
  - 网络控制协议（NCP）允许在点到点连接上使用多种网络层协议，如图所示
  {% asset_img ppp协议的组成.png ppp协议的组成 %}

### PPP协议帧格式

{% asset_img PPP协议帧格式.png PPP协议帧格式%}
标志字段F = 0x7E（符号“0x”表示后面的额字符时用十六进制表示。十六进制的7E的二进制表示时0111110）
地址字段A只置为0xFF。地址字段实际上并不起作用。
控制字段C通常置为0x03。
PPP时面向字节的，所有的PPP帧的长度都是整数字节。

### 字节填充

问题：信息字段中出现了标志字段的值，可能会被误认为时“标志”，怎么办？

1. 将信息字段中出现的每个0x7E字节转变成为2字节序列（0x7D，0x5E）
2. 若信息字段中出现一个0x7D的字节，则将其转变成为2字节序列（0x7D，0x5D）
3. 若信息字段中出现ASCII码的控制字符（即数值小于0x20的字符），则在该字符前面要加入一个0x7D字节，同时将该字符的编码加以改变。

### 零比特填充方法

PPP协议用在SONET/SDH链路时，是使用同步传输（一连串的比特连续传送）。这时PPP协议采用**零比特填充方法**来实现透明传送。
在发送端，只要发现有5个连续1，则立即填入一个0.接收端对帧中的比特流进行扫描。每当发现5个连续1时，就把这个连续1后的一个0删除。
{% asset_img 零比特填充法.png 零比特填充法%}

### 不适用序号和确认机制

PPP协议之所以不适用序号和确认机制时出于以下的考虑：

- 在数据链路层出现差错的概率不大时，使用比较简单的PPP协议较为合理。
- 在因特网环境下，PPP的信息字段放入的数据时IP数据报。数据链路层的可靠传输并不能够保证网络层的传输也是可靠的。
- 帧检验序列FCS字段可保证无差错接受。

### PPP协议的工作状态

当用户拨号接入ISP时，路由器的调制解调器对拨号做出确认，并建立一条物理连接。
PC机向路由器发送一系列的LCP分组（封装成多个PPP帧）。
这些分组及其响应选择一些PPP参数，和进行网络层配置NCP给新接入的PC机分配一个临时的IP地址，使PC机成为因特网上的一个主机。
通信完毕时，NCP释放网络层连接，收回原来分配出去的IP地址。接着，LCP释放数据链路层连接。最后释放的使物理层的连接。

## 使用广播信道的数据链路层

### 共享通信媒体

静态划分信道（太麻烦，现在很少使用）

 1. 频分复用
 2. 时分复用
 3. 波分复用
 4. 码分复用

动态媒体接入控制（多点接入）

- **随机接入（主要被以太网采用）**
- 受控接入，如多点线路探寻，或轮询（目前已不被采用）

### 认是以太网

最初的以太网使将许多计算机都连接到一根总线上。当初认为这样的连接方法既简单有可靠，因为总线上没有有源器件
{% asset_img 以太网.png 以太网%}
总线上的每一个工作的计算机都能检测到B发送的数据信号。
由于只有jisuanjiD的地质与首部写入的地址一致，因此只有D才接受这个数据帧。
其他所有的计算机（A，C和E）都检测到不是发送给他们的数据帧，因此就丢弃这个数据帧而不能够收下来。
具有广播特性的总线上实现了一对一的通信。

#### 载波监听多点接入/碰撞检测 以太网使用CSMA/CD协议

CSMA/CD表示 Carrier sense Multiple Access with Collision Detection。

“**多点接入**”表示许多计算机以多点接入的方式连接在一根总线上。

“**载波监听**”是指每一个站在发送数据之前先要检测一下总线上是否有其他计算机在发送数据，如果有，则暂时不要发送数据，以免发送碰撞。
它是用电子技术检测总线上有没有其他计算机发送的数据信号。

## 以太局域网（以太网）

### 概念

> DIX Ethernet V2 是世界上第一个局域网产品（以太网）的规约。
  IEEE的802.3标准。
  DIX Ethernet V2 标准与IEEE的802.3标准只有很小的差别，因此可以将802.3局域网简称为“以太网”
  严格来说，“以太网”应当是指符合DIX Ethernet V2 标准的局域网

为了使数据链路层能更好地适应多种局域网标准，802委员会就将局域网的数据链路层拆成两个子层：
    1. 逻辑链路层控制LLC（Logical Link Control）子层
    2. 媒体接入控制`MAC`（Medium Access Control）子层

#### 以太网提供的服务

以太网提供的服务使不可靠的交付，即尽最大努力的交付。
当接收站收到有差错的数据帧时就丢弃此帧，其他什么也不做。差错的纠正由高层来决定。
如果高层发现丢失了一些数据而进行重传，但以太网并不知道这是一个重传的帧，而是当作一个信道额数据帧来发送。

### 拓扑

1. 星型拓扑
2. 集线器的一些特点：集线器时使用电子器件来模拟实际电缆线的工作，因此整个系统仍然享一个传统的以太网那样运行。
    {% asset_img 集线器的特点.png 集线器的特点%}
    集线器很像一个多借口的转发器，工作在物理层。
3. 10Base-T

### 以太网的信道利用率

### MAC层

#### MAC层的硬件地址（MAC地址）

在局域网种，硬件地址又称为物理地址，或MAC地址

{% asset_img MAC地址.png MAC地址%}

#### MAC帧格式

{% asset_img MAC帧格式.png  MAC帧格式 %}

#### 无效的MAC帧

帧的长度不是整数个字节；
用收到的帧检验序列FCS查出有差错；
数据字段的长度不在46~1500字节之间。
有效的MAC帧长度为64~1518字节之间。
对于检查除的无效MAC帧就简单地丢弃，以太网不负责重传丢弃的帧。

#### 帧间最小间隔

帧间最小间隔为9.6μs，相当于96bit的发送时间。一个站在检测到总线开始空闲后，还要等待9.6μs才能再次发送数据。
这样做是为了使刚刚收到数据帧的站的接收缓存来得及清理，做好接收下一帧的准备。