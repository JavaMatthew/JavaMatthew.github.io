---
title: 方法区
p: 后端/Java/JVM/方法区
date: 2020-12-13 19:08:22
tags: [Java,JVM]
categories: [Java,JVM]
---
## 栈、堆、方法区的交互关系

- 从线程共享与否的角度来看

{% asset_img 运行时数据区结构图.png 运行时数据区结构图%}
{% asset_img 实例.png 实例%}

## 方法区的理解

1. 方法区和java堆一样，是各个线程共享的内存区域
2. 方法区在JVM启动的时候被创建，并且它的实际物理内存空间和Java堆区一样都可以是不连续的。
3. 方法区的大小，跟堆空间一样，可以选择固定大小或者可扩展。
4. 方法区的大小决定了系统可以保存多少个类，如果系统定义了太多的类，导致方法区溢出，虚拟机同样会抛出内存一处错误：java.lang.OutOfMemoryError:PermGen space 或者 java.lang.OutOfMemoryError: Metaspace
5. 关闭JVM就会释放这个区域的内存。

## 设置方法区大小的参数

- jdk8以后
    元数据区大小可以使用参数-XX:MetaspaceSize=100m和-XX:MaxMetaspaceSize=100m指定，替代上述原有的两个参数。
    默认值依赖于平台。windows下，-XX:MetaspaceSize是21M，-XX:MaxMetaspaceSize的值是-1，即没有限制。
    与永久代不同，如果不指定大小，默认情况下，虚拟机会耗尽所有的可用系统内存。如果元数据区发生溢出，虚拟机一样会跑出异常OutOfMemoryError:Metaspace

## 方法区存储什么

> 类型信息、常量、静态变量、及时编译器后的代码缓存等。

{% asset_img 总结.png 总结%}

堆中存的是本地常量池引用，方法区中存的是实际的信息。
