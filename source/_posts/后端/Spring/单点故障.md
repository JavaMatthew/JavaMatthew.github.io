---
title: 单点故障
date: 2020-09-23 17:46:02
tags: Spring
categories: Spring
---
## 分布式锁应用场景

在分布式锁服务中，有一种最典型应用场景，就是通过对集群进行Master选举。来解决分布式系统中的单点故障、双主问题。

什么是分布式系统中的单点故障：通常分布式系统采用主从模式，就是一个主机连接多个处理节点。主节点负责处理任务，当我们的主节点发生故障时，那么整个系统就都瘫痪了，那么我们把这种故障叫做 单点故障。

什么是双主问题：为了解决单点故障，我们准备了一个主节点B，每隔10s会ping一次主节点A，当因为某种网络原因没有即使返回请求，B主节点会自动晋升管理从节点，但是当A节点网络恢复时会自动管理从节点，这时从节点就会同时被两个主节点管理，这就是双主问题。

## 分布式锁应该具备哪些条件

1. 在分布式系统环境下，一个方法在同一时间只能被一个机器的一个线程执行A
2. 高可用的获取锁与释放锁
3. 高性能的获取锁与释放锁
4. 具备可重入特性（可理解为重新进入，由于一个任务并发使用，而不必担心数据错误）
5. 具备锁失效机制，防止死锁
6. 具备非阻塞锁特性，即没有获得到锁将直接返回获取锁失败

## 面试

1. 服务注册与发现中心常用的软件都有什么？
    - Eureka
    - Consul
    - Zookeeper
2. 他能解决什么问题？
    解决了分布式锁的问题，解释单点故障

3. 如何解决的？
    Consul维护了一个节点列表，它会进行选举一个节点为主节点，其他节点为备用节点进入阻塞状态。如果出现网络震荡问题，它会把该主节点从列表中删掉，而不是停掉。备用节点继续选举一个主节点管理从节点，当该服务恢复会重新注册一个节点，这时它为备用节点。
